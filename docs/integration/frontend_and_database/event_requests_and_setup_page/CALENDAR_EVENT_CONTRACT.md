Calendar event contract (what the UI expects)
=============================================

This project renders calendar entries straight from the Supabase `events` table. The React hook `src/hooks/useEvents.ts`:
- queries `events` filtered by `team_id`
- joins `clients` for contact display
- resolves `room_ids` against the `rooms` table to get names/colors
- keeps the cache live via a Postgres changes channel

Any record inserted into `public.events` with the right shape will immediately appear in the calendar/list/pipeline views once the team matches the user’s selected team.

Event table shape (current)
---------------------------
Source of truth: `src/integrations/supabase/types.ts` (`events` row).

Required
- `id` (uuid, autogenerated if omitted)
- `user_id` (owner/creator)
- `team_id` (team that will see the event)
- `title` (string)
- `event_date` (date `YYYY-MM-DD`)
- `start_time` (time `HH:MM[:SS]`)
- `end_time` (time `HH:MM[:SS]`)
- `status` (string; UI recognizes `lead`, `option`, `confirmed`, `cancelled`)

Optional
- `end_date` (date) — for multi-day events; inclusive range
- `room_ids` (uuid[]) — links to `rooms.id` for color-coding and labels
- `client_id` (uuid) — links to `clients.id`
- `attendees` (int)
- `description`, `notes`
- `assigned_to`, `created_by` (user ids)
- `is_blocked` (bool) + `block_reason` (string) — renders as a grey “Blocked” card across the date range

Fields the frontend actually uses
---------------------------------
- `event_date` and `end_date` determine which days the card spans (month/week/day views all use this inclusive range).
- `start_time`/`end_time` position the block in week/day grids and are shown in tooltips/list view.
- `title` is the primary label.
- `status` controls badge color (`calendarUtils#getStatusBackgroundColor`).
- `room_ids` pulls room names/colors; the first room color drives the border on calendar cards.
- `clients.name` (via `client_id` join) shows in the list view; it can be null.
- `is_blocked` + `block_reason` renders a special “Blocked” entry instead of a normal event card.

Minimal payload to create a visible event
-----------------------------------------
Insert into `public.events` with at least:
```json
{
  "title": "Site visit – Acme",
  "event_date": "2025-03-12",
  "start_time": "10:00:00",
  "end_time": "11:30:00",
  "status": "lead",
  "team_id": "<team-uuid>",
  "user_id": "<creator-uuid>"
}
```
Recommended extras for better UX:
- `room_ids`: `["<room-uuid>"]` (enables room badge + color)
- `client_id`: `<client-uuid>` (shows client name in list view)
- `attendees`: integer
- `notes`/`description`: shown on detail page
- `end_date`: set when spanning multiple days (e.g., conferences)

Blocking dates
--------------
To mark a date as unavailable (grey block in the calendar):
```json
{
  "title": "Blocked Date",
  "event_date": "2025-03-15",
  "start_time": "00:00:00",
  "end_time": "23:59:59",
  "status": "lead",
  "is_blocked": true,
  "block_reason": "Venue maintenance",
  "team_id": "<team-uuid>",
  "user_id": "<creator-uuid>"
}
```

How an external email agent should create events
------------------------------------------------
1) Ensure the agent knows the target `team_id` (the frontend only shows events for the user’s current team).
2) Create or look up the `client_id` (optional) and `room_ids` (optional) beforehand if you want those to display.
3) Insert into `public.events` using the payload above. If you use a service role key, you must set `user_id` and `team_id` explicitly; if you use a user session, Supabase RLS already allows that user to insert for their team.
4) Use `YYYY-MM-DD` for dates and `HH:MM:SS` for times; timezone handling is currently manual (stored as strings), so write local venue time.
5) No extra indexing or syncing is needed—the UI subscribes to DB changes and will pick the record up automatically.

Status values and colors
------------------------
- `lead` (yellow), `option` (blue), `confirmed` (green), `cancelled` (red). Anything else falls back to the lead color.

At-a-glance mapping from a typical calendar invite
--------------------------------------------------
- Invite title → `title`
- Start/end datetime → split into `event_date`/`end_date` (dates) and `start_time`/`end_time` (times)
- Location/room → map to existing `rooms.id` and set `room_ids`
- Organizer/contact → create/attach `client_id`
- RSVP count → `attendees`
- “Busy/blocked” holds → set `is_blocked` + `block_reason`
